# Определение стоимости автомобилей

Проект посвящён разработке модели, которая по характеристикам подержанного автомобиля предсказывает его рыночную стоимость.  
Модель разрабатывается для сервиса продажи автомобилей «Не бит, не крашен» и должна быть достаточно точной и быстрой для использования в продакшене.

---

## Цели исследования

- Проанализировать исходные данные об автомобилях и их ценах.  
- Выявить ошибки, выбросы и аномалии в данных и скорректировать их.  
- Подготовить признаки для обучения моделей: числовые и категориальные.  
- Обучить и сравнить несколько моделей регрессии по качеству и скорости:  
  - качество предсказания (RMSE),  
  - время обучения,  
  - время предсказания.  
- Выбрать модель, удовлетворяющую условию: **RMSE < 2500**.  

---

## Данные

Данные находятся в файле **`autos.csv`**.  
Каждая строка — отдельное объявление о продаже автомобиля.

Основные признаки:

- `price` — цена (евро), целевой признак;  
- `vehicle_type` — тип кузова;  
- `registration_year` — год регистрации автомобиля;  
- `gearbox` — тип коробки передач;  
- `power` — мощность (л.с.);  
- `model` — модель;  
- `kilometer` — пробег (км);  
- `registration_month` — месяц регистрации;  
- `fuel_type` — тип топлива;  
- `brand` — марка;  
- `repaired` — состояние (были/не были в ремонте);  
- `date_crawled`, `date_created`, `last_seen` — временные признаки, связанные с обработкой и жизненным циклом объявления;  
- `number_of_pictures` — количество фотографий;  
- `postal_code` — почтовый индекс.

В исходных данных обнаружены пропуски, подозрительные значения и аномалии (например, цена = 0, некорректный год регистрации, нулевая мощность и др.).

---

## Предобработка данных

Выполнены следующие этапы:

- **Удаление явных аномалий:**
  - строки с `price = 0` и другими некорректными значениями цены;  
  - слишком высокие значения цены, не соответствующие реальному рынку;  
  - некорректные года регистрации (слишком старые или будущие);  
  - нулевая или явно ошибочная мощность двигателя.

- **Обработка дубликатов:**
  - найдено небольшое количество полных дубликатов — они удалены.

- **Пропуски:**
  - в некоторых категориальных признаках пропуски заполнены наиболее частыми значениями;  
  - в части признаков с низкой значимостью пропуски допускались, если признаки далее исключались из модели.

- **Работа с временными признаками:**
  - временные поля (`date_crawled`, `date_created`, `last_seen`) проанализированы;  
  - сделан вывод, что они не несут значимого вклада в предсказание цены — признаки удалены.

- **Формирование набора признаков:**
  - оставлены только те признаки, которые отражают реальные характеристики автомобиля и его состояния (год регистрации, пробег, мощность, марка, модель, тип коробки, состояние ремонта и др.);  
  - целевой признак `price` очищен от нулей и экстремальных выбросов.

---

## Исследовательский анализ данных (EDA)

В процессе анализа:

- Изучено распределение цены:  
  - распределение сильно скошено, присутствуют выбросы;  
  - после отсечения экстремальных значений распределение становится ближе к реальному рынку.

- Изучены ключевые числовые признаки:
  - `registration_year` — чем новее автомобиль, тем выше его цена;  
  - `power` — рост мощности в целом сопровождается ростом стоимости, но есть выбросы (очень высокие значения мощности);  
  - `kilometer` — чем больше пробег, тем ниже стоимость.

- Проанализированы категориальные признаки:
  - `gearbox` — большинство объявлений с механической коробкой, автомат дороже;  
  - `fuel_type` — бензин/дизель доминируют, альтернативные виды топлива встречаются реже;  
  - `brand` — некоторые бренды представлены шире, но по цене могут перекрываться с другими;  
  - `repaired` — автомобили без ремонта в среднем дороже, чем побывавшие в ремонте.

- Временные признаки показали равномерное или техническое распределение и не были связаны с ценой напрямую, поэтому исключены.

---

## Корреляционный анализ и мультиколлинеарность

- Построена **матрица корреляций** для числовых признаков.  
- Наибольшая связь с ценой наблюдается у:
  - мощности (`power`),  
  - года регистрации (`registration_year`),  
  - пробега (`kilometer`).  

- Выявлены группы признаков, сильно коррелирующих между собой (например, `model`, `vehicle_type` и `brand` связаны между собой и с ценой).  
- Отдельно оценена **мультиколлинеарность** (через коэффициент VIF) среди числовых признаков — критических значений не выявлено.  
- Часть категориальных признаков, дублирующих информацию или сильно завязанных друг на друга при слабой связи с целевым признаком, была исключена из набора признаков.

---

## Обучение моделей

### Подготовка данных к моделированию

- Данные разбиты на обучающую и тестовую выборки.  
- Числовые признаки нормализованы / стандартизованы, где это было необходимо.  
- Категориальные признаки преобразованы:
  - для линейных моделей — кодирование (например, One-Hot Encoding);  
  - для деревьев решений и градиентного бустинга — использованы соответствующие возможности библиотек (CatBoost, LightGBM).

### Набор моделей

Были обучены и сравнены:

- **LinearRegression** — линейная регрессия;  
- **RandomForestRegressor** — случайный лес;  
- **LightGBM** — градиентный бустинг по деревьям;  
- **CatBoostRegressor** — градиентный бустинг от CatBoost.

Для каждой модели оценивались:

- метрика **RMSE** на валидационной и тестовой выборках;  
- время обучения;  
- время предсказания.

---

## Сравнение моделей

Основные наблюдения:

- **Линейная регрессия**  
  - показала наихудшее качество;  
  - RMSE значительно выше целевого порога 2500;  
  - модель исключена из дальнейшего рассмотрения.

- **RandomForestRegressor**  
  - качество на уровне бустинговых моделей или немного хуже;  
  - время обучения и предсказания заметно выше, особенно на большом числе деревьев;  
  - модель признана слишком тяжёлой по времени для продакшена.

- **LightGBM**  
  - показал хорошее качество: RMSE порядка **1765–1846**;  
  - время обучения и предсказания небольшое;  
  - модель является сильным кандидатом.

- **CatBoostRegressor**  
  - дал качество на уровне лучших моделей (RMSE существенно ниже 2500, порядка ~1800);  
  - обучение и предсказание проходят достаточно быстро;  
  - хорошо работает с категориальными признаками и менее чувствителен к подготовке признаков.

По совокупности показателей (качество + скорость) **оптимальной признана модель CatBoostRegressor**.

---

## Финальная модель

В качестве финальной выбрана **CatBoostRegressor**, удовлетворяющая следующим требованиям:

- **RMSE < 2500** на тестовой выборке (фактическое значение RMSE — порядка ~1800 евро);  
- приемлемое время обучения;  
- высокая скорость предсказания, подходящая для онлайнового расчёта стоимости автомобиля при заполнении анкеты пользователем.

---

## Анализ важности признаков

По результатам анализа важности:

- наибольший вклад в предсказание цены вносят:
  - **год регистрации (`registration_year`)** — новые автомобили дороже;  
  - **мощность (`power`)** — более мощные авто, как правило, дороже;  
  - **пробег (`kilometer`)** — высокий пробег снижает рыночную стоимость;  
  - **марка и модель (`brand`, `model`)** — бренд и модель сильно влияют на ожидания покупателя;  
  - **тип коробки передач и состояние ремонта (`gearbox`, `repaired`)**.

Менее значимыми оказались:

- различные коды и служебные признаки (`postal_code` и т.п.);  
- некоторые категориальные признаки, слабо влияющие на итоговую цену.

---

## Используемый стек

- **Python** — основной язык разработки  
- **pandas** — загрузка и обработка данных  
- **NumPy** — численные операции и работа с массивами  
- **matplotlib**, **seaborn** — визуализация распределений и зависимостей  
- **scikit-learn** — базовые модели, разбиение выборки, метрики (RMSE), предобработка признаков  
- **LightGBM** — градиентный бустинг по деревьям с фокусом на скорость  
- **CatBoost** — градиентный бустинг с поддержкой категориальных признаков  

---

## Основные выводы

- Исходные данные содержали ошибки, выбросы и некорректные значения, которые были выявлены и устранены.  
- После предобработки сформирован адекватный набор признаков, отражающий реальные характеристики автомобиля и его состояние.  
- Анализ показал, что ключевыми факторами цены являются год регистрации, мощность, пробег, марка, модель и состояние ремонта.  
- Сравнение нескольких моделей продемонстрировало, что линейная регрессия не подходит по качеству, а случайный лес — по времени работы.  
- Градиентный бустинг (LightGBM, CatBoost) показал наилучшее сочетание качества и скорости.  
- В качестве финального решения выбрана модель **CatBoostRegressor**, обеспечивающая **RMSE значительно ниже 2500** и подходящая для использования в сервисе оценки стоимости подержанных автомобилей.
