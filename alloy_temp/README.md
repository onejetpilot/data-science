# Предсказание температуры стального сплава

Проект посвящён разработке модели, которая прогнозирует конечную температуру плавки стального сплава на основе данных производственного процесса.  
Цель — помочь металлургическому предприятию оптимизировать энергопотребление и улучшить контроль качества продукции.

---

## Цели исследования

- Изучить структуру данных технологического процесса плавки.  
- Выявить ошибки, пропуски и аномалии во всех таблицах.  
- Подготовить данные: очистить, преобразовать и агрегировать информацию по партиям.  
- Создать новые признаки, отражающие длительность этапов обработки и характеристики материалов.  
- Объединить данные из всех таблиц в финальный датасет.  
- Обучить модель для прогнозирования конечной температуры.  
- Оценить качество модели (основная метрика — MAE).  
- Выявить ключевые признаки и предложить рекомендации по улучшению процесса.

---

## Данные

Данные представлены в формате SQLite и включают следующие таблицы:

### Таблица **data_arc** — работа дуговой печи
- время начала и окончания нагрева;
- активная и реактивная мощность;
- длительность и число включений нагрева.

### Таблица **data_bulk** — объём сыпучих материалов
- Bulk1 … Bulk15 — веса добавляемых материалов.

### Таблица **data_bulk_time** — время подачи сыпучих материалов
- Bulk1 … Bulk15 — продолжительность этапов подачи.

### Таблица **data_wire** — объём проволочных материалов
- Wire1 … Wire9 — количество вводимых присадок.

### Таблица **data_wire_time** — время подачи проволки
- Wire1 … Wire9 — длительность подачи.

### Таблица **data_gas** — продувка газом
- расход газа за цикл.

### Таблица **data_temp** — измерения температуры
- время замера;
- значение температуры.

Во всех таблицах используется общий ключ **key** — номер партии.

---

## Предобработка данных

Для каждой таблицы выполнены:

### Общие проблемы:
- пропуски в объёмах материалов → заменены на 0, что соответствует отсутствию подачи;  
- неверный тип данных (`object`, `string`) → приведены к числовому или datetime;  
- отрицательные значения реактивной мощности → исправлены или удалены как ошибочные;  
- аномальные температуры (<1500°C) → удалены как ошибочные замеры;  
- неверные временные интервалы (BeginHeat > EndHeat) → исправлены расчётом длительности.

### Создание новых признаков:
- **FullHeat** — общая длительность нагрева;  
- **HeatCount** — количество запусков нагрева;  
- **FullBulkTime** — суммарное время подачи сыпучих материалов;  
- **FullWireTime** — суммарное время ввода проволоки;  
- **TempStart** — температура в начале плавки (первый замер);  
- агрегированные объёмы материалов (BulkTotal, WireTotal).

---

## Исследовательский анализ данных (EDA)

Исследованы:

### Дуговой нагрев (data_arc)
- активная мощность в пределах нормы (пик в 4–6 МВт);
- есть редкие выбросы до 15–16 МВт;
- длительность нагрева корректна.

### Сыпучие материалы (bulk)
- 1–7 подач на цикл, пик в 4 подачи;
- большие объёмы встречаются редко.

### Время подачи сыпучих материалов (bulk_time)
- распределения адекватные;
- длительность процесса до суток.

### Продувка газом
- нормальное распределение, редкие выбросы до 70–80.

### Температура
- аномальные замеры ниже 1500°C удалены;
- временные ряды преобразованы к форматам datetime.

### Проволочные материалы (wire)
- много пропусков → заменены на 0;
- данные приведены в соответствие по ключу партии.

---

## Формирование финального датасета

Для каждой партии выполнено:

- объединение данных по ключу `key`;  
- агрегация признаков по объёму, времени и характеристикам нагрева;  
- расчёт итоговой температуры как последнего замера;  
- проверка корректности финального набора признаков.

---

## Обучение моделей

В качестве основной модели выбран **CatBoostRegressor**, так как:

- хорошо работает с числовыми и категориальными признаками;
- устойчив к пропускам;
- не требует сложной подготовки признаков.

Модель обучена на тренировочной выборке и протестирована на тестовой.

---

## Качество модели

Финальная метрика:

### **MAE = 5.769°C**

Это означает:

- средняя ошибка прогноза температуры — около **5.8 градусов**;
- следовательно, модель предсказывает результат с высокой точностью;
- Dummy-модель показала заметно худшие результаты → модель обучилась корректно.

---

## Важность признаков

Ключевыми факторами оказались:

1. **TempStart** — температура в начале плавки.  
2. **FullHeat** — общая длительность нагрева.  
3. **ActivePower** — активная мощность на этапе нагрева.

Признаки с низкой значимостью:

- отдельные проволочные материалы;  
- второстепенные Bulk-признаки;  
- временные интервалы с минимальным вкладом.

---

## Основные выводы

### Процесс подготовки данных:
- изучены распределения признаков по каждой таблице;  
- аномалии исправлены или удалены;  
- созданы новые инженерные признаки;  
- данные агрегированы в единый датасет.

### Качество модели:
- MAE < 6°C — высокий уровень точности;  
- модель устойчива, предсказания объяснимы;  
- рост температуры логично зависит от начальной температуры и длительности нагрева.

### Рекомендации по улучшению модели:
- более глубокая обработка выбросов;  
- тестирование ансамблей (LightGBM, RandomForest);  
- добавление инженерных признаков по температурным датчикам;  
- анализ влияния химического состава материалов.

### Рекомендации бизнесу:
- использовать модель для мониторинга и прогнозирования температурного режима;  
- автоматизировать определение момента завершения нагрева;  
- отслеживать аномалии датчиков и некорректные замеры;  
- при необходимости расширить сбор данных о химических составах материалов.

---

## Используемый стек

- Python  
- pandas, NumPy  
- matplotlib, seaborn  
- CatBoost  
- sklearn (train/test split, MAE)  
